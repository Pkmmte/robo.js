/*! For license information please see d3c3ca18.25bc5d7c.js.LICENSE.txt */
"use strict";(self.webpackChunkrobo_js_docs=self.webpackChunkrobo_js_docs||[]).push([[4370],{2061:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>s});var r=t(5893),i=t(1151);const a={image:"https://preview.robojs.dev?path=/discord-bots/middleware"},d="\ud83c\udf19 Middleware",o={id:"discord-bots/middleware",title:"\ud83c\udf19 Middleware",description:"In the heart of your Robo, there lies a potent feature known as Middleware. These are functions that are executed before each and every command or event, granting you the ability to manipulate data, introduce conditional flows, and even halt execution of events or commands based on custom criteria.",source:"@site/docs/discord-bots/middleware.md",sourceDirName:"discord-bots",slug:"/discord-bots/middleware",permalink:"/discord-bots/middleware",draft:!1,unlisted:!1,editUrl:"https://github.com/Wave-Play/robo.js/edit/main/docs/docs/discord-bots/middleware.md",tags:[],version:"current",lastUpdatedBy:"Pkmmte Xeleon",lastUpdatedAt:1715232634e3,frontMatter:{image:"https://preview.robojs.dev?path=/discord-bots/middleware"},sidebar:"tutorialSidebar",previous:{title:"\ud83c\udfe0 Inviting to Servers",permalink:"/discord-bots/invite"},next:{title:"\u2b50 Migrating",permalink:"/discord-bots/migrate"}},l={},s=[{value:"Crafting Middleware \ud83d\udee0\ufe0f",id:"crafting-middleware-\ufe0f",level:2},{value:"The MiddlewareData Parcel \ud83d\udce6",id:"the-middlewaredata-parcel-",level:2},{value:"Manipulating Payloads \ud83d\udd04",id:"manipulating-payloads-",level:2},{value:"Gatekeeping with Middleware \ud83d\udea7",id:"gatekeeping-with-middleware-",level:2},{value:"Command Control with Middleware \ud83d\udea6",id:"command-control-with-middleware-",level:2},{value:"Efficient Middleware \u23f1\ufe0f",id:"efficient-middleware-\ufe0f",level:2},{value:"Error Handling \u26a0\ufe0f",id:"error-handling-\ufe0f",level:2},{value:"Experimental Feature Warning \ud83d\udea7",id:"experimental-feature-warning-",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"-middleware",children:"\ud83c\udf19 Middleware"}),"\n",(0,r.jsx)(n.p,{children:"In the heart of your Robo, there lies a potent feature known as Middleware. These are functions that are executed before each and every command or event, granting you the ability to manipulate data, introduce conditional flows, and even halt execution of events or commands based on custom criteria."}),"\n",(0,r.jsx)(n.p,{children:"They are like the night's watch, ever-vigilant before every event and command, including those nested inside modules and plugins!"}),"\n",(0,r.jsx)(n.h2,{id:"crafting-middleware-\ufe0f",children:"Crafting Middleware \ud83d\udee0\ufe0f"}),"\n",(0,r.jsxs)(n.p,{children:["Crafting middleware for your Robo is simple and straightforward. Create files inside the ",(0,r.jsx)(n.code,{children:"/src/middleware"})," directory. The filenames don't really matter but remember they run alphabetically. Number prefixes can control the order (like ",(0,r.jsx)(n.code,{children:"01-preliminary.js"}),"). Even if placed inside modules, middleware files still impact your entire Robo!"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"src/\n\u2514\u2500\u2500 middleware/\n    \u251c\u2500\u2500 01-check-roles.js\n    \u251c\u2500\u2500 02-set-timestamp.js\n    \u2514\u2500\u2500 03-example-logger.js\n"})}),"\n",(0,r.jsx)(n.h2,{id:"the-middlewaredata-parcel-",children:"The MiddlewareData Parcel \ud83d\udce6"}),"\n",(0,r.jsxs)(n.p,{children:["Each middleware function gets a ",(0,r.jsx)(n.code,{children:"MiddlewareData"})," object which contains a ",(0,r.jsx)(n.code,{children:"payload"})," array and a ",(0,r.jsx)(n.code,{children:"record"})," object. The ",(0,r.jsx)(n.code,{children:"payload"})," carries interaction objects that are passed to the event or command, while ",(0,r.jsx)(n.code,{children:"record"})," provides insights about what's being intercepted."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"record"})," object has key information:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"auto"})," shows if the record was automatically generated."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"handler"})," is a reference to the file handling the interaction. It usually contains a ",(0,r.jsx)(n.code,{children:"default"})," function and might have a ",(0,r.jsx)(n.code,{children:"config"})," object."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"key"})," is a unique string representing a command or event. Subcommands appear as ",(0,r.jsx)(n.code,{children:"parent/child"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"module"})," points to the module of the record. Nested modules appear as ",(0,r.jsx)(n.code,{children:"parent/child"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"path"})," locates the handler file."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"plugin"})," contains name and path if the record is part of a plugin."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"type"})," indicates if the record is a 'command', 'context', or 'event'."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"manipulating-payloads-",children:"Manipulating Payloads \ud83d\udd04"}),"\n",(0,r.jsx)(n.p,{children:"Middleware is empowered to mutate the interaction objects, thus impacting the way events and commands behave:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",metastring:'title="/src/middleware/01-example.middleware.js" showLineNumbers',children:"export default function (data) {\n\tconst [interaction] = data.payload\n\tinteraction.middlewareTimestamp = Date.now()\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"gatekeeping-with-middleware-",children:"Gatekeeping with Middleware \ud83d\udea7"}),"\n",(0,r.jsxs)(n.p,{children:["Middleware can be a gatekeeper, deciding if an event or command should proceed. If a middleware function returns ",(0,r.jsx)(n.code,{children:"{ abort: true }"}),", the event or command execution is halted. Here's an example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",metastring:'showLineNumbers {7} title="/src/middleware/02-example.middleware.js"',children:"import { isModuleEnabled } from './utils.js'\n\nexport default async function (data) {\n\tconst moduleStatus = await isModuleEnabled(data.record.module)\n\n\tif (!moduleStatus) {\n\t\treturn { abort: true }\n\t}\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"command-control-with-middleware-",children:"Command Control with Middleware \ud83d\udea6"}),"\n",(0,r.jsx)(n.p,{children:"This ability can be leveraged for user roles-based access control:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",metastring:'showLineNumbers {5-8} title="/src/middleware/03-admin.middleware.js"',children:"export default function (data) {\n\tconst [interaction] = data.payload\n\tconst userRoles = interaction.member.roles.cache.map((role) => role.name)\n\n\tif (data.record.key.startsWith('admin/') && !userRoles.includes('Admin')) {\n\t\tinteraction.reply('Sorry, this command is only for Admins!')\n\t\treturn { abort: true }\n\t}\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"efficient-middleware-\ufe0f",children:"Efficient Middleware \u23f1\ufe0f"}),"\n",(0,r.jsx)(n.p,{children:"Remember to keep your middleware lean and efficient. The execution of events and commands is on hold until middleware finishes. Keep the bot responsive!"}),"\n",(0,r.jsx)(n.h2,{id:"error-handling-\ufe0f",children:"Error Handling \u26a0\ufe0f"}),"\n",(0,r.jsx)(n.p,{children:"A crucial thing to note is that any errors thrown within a middleware will halt the execution of the associated event or command. Therefore, it's essential to implement robust error handling within your middleware to prevent unwanted disruptions."}),"\n",(0,r.jsx)(n.h2,{id:"experimental-feature-warning-",children:"Experimental Feature Warning \ud83d\udea7"}),"\n",(0,r.jsx)(n.p,{children:"Middleware is still an experimental feature, and the API might change before we hit v1. Presently, it operates for all events, but future updates could let you specify target events. Stay tuned for updates!"})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},5251:(e,n,t)=>{var r=t(7294),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function s(e,n,t){var r,a={},s=null,c=null;for(r in void 0!==t&&(s=""+t),void 0!==n.key&&(s=""+n.key),void 0!==n.ref&&(c=n.ref),n)d.call(n,r)&&!l.hasOwnProperty(r)&&(a[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===a[r]&&(a[r]=n[r]);return{$$typeof:i,type:e,key:s,ref:c,props:a,_owner:o.current}}n.Fragment=a,n.jsx=s,n.jsxs=s},5893:(e,n,t)=>{e.exports=t(5251)},1151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>d});var r=t(7294);const i={},a=r.createContext(i);function d(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);